```{r}
#| label: load R packages
library("dplyr")
library("kableExtra")
library("ggplot2")
library("viridis")
library('palmerpenguins')
library('tidyr')
library("dplyr")
library("rpart")
library("DALEX")
library("ceterisParibus")
library("randomForest")
library('iml')
library('patchwork')
library('grid')
library('gridExtra')
library('ranger')
library('reshape2')
library('mlr')
# For training multinomial logistic regression
library('nnet')
```

```{r}
#| label: penguin data and models
set.seed(2)
penguins = na.omit(penguins)
penguins_orig = penguins
penguins_col_selection = c('species', 'bill_depth_mm', 'bill_length_mm', 'flipper_length_mm', 'sex', 'body_mass_g') 
penguins = penguins[penguins_col_selection] 
penguin_train_index <- sample(1:nrow(penguins), 2/3 * nrow(penguins))
penguins_train <- penguins[penguin_train_index, ]
penguins_test <- penguins[-penguin_train_index, ]

# Make sure P(female) is predicted
penguins$sex <- relevel(penguins$sex, ref = "male")
pengu_rf = randomForest(sex ~ ., data = penguins_train)
pengu_tree = rpart(sex ~ ., data = penguins_train)
pengu_logreg = glm(sex ~ ., data = penguins_train, trace = FALSE, family = binomial(link="logit"))
```



```{r}
#| label: bike data and models
set.seed(42)
load("../data/bike.RData")
bike_features =  c('season','holiday', 'workingday', 'weathersit', 'temp', 'hum', 'windspeed',  "days_since_2011")
bike = bike[c(bike_features, "cnt")]
bike_train_index <- sample(1:nrow(bike), 2/3 * nrow(bike))
bike_train <- bike[bike_train_index, ]
bike_test <- bike[-bike_train_index, ]
bike_rf = randomForest(cnt~ ., data = bike_train)
bike_tree = rpart(cnt ~ ., data = bike_train)
bike_svm = e1071::svm(cnt ~ ., data = bike_train)
bike_lm = lm(cnt ~ ., data = bike_train, x = TRUE)
```


```{r}
#| label: load data
set.seed(42)

## Load datasets
load("../data/ycomments.RData")
```

```{r}
my_theme = function(legend.position='right'){
  theme_bw() %+replace%
    theme(legend.position=legend.position)
}

theme_set(my_theme())
default_color = "azure4"
```


```{r}
#| label: define util functions

pretty_rownames = function(rnames){
  rnames = gsub('^`', '', rnames)
  rnames = gsub('`$', '', rnames)
  rnames = gsub('`', ':', rnames)
  rnames
}

```

